<!DOCTYPE html>
<!-- saved from url=(0055)https://karloespiritu.github.io/cheatsheets/postgresql/ -->
<html lang="en-us" data-ember-extension="1" class="gr__karloespiritu_github_io"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      Postgresql · Cheatsheets
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="./Postgresql · Cheatsheets_files/poole.css">
  <link rel="stylesheet" href="./Postgresql · Cheatsheets_files/syntax.css">
  <link rel="stylesheet" href="./Postgresql · Cheatsheets_files/blackdoc.css">
  <link rel="stylesheet" href="./Postgresql · Cheatsheets_files/css">
  <link rel="stylesheet" href="./Postgresql · Cheatsheets_files/css(1)">

  <!-- Icons -->

  <!-- For non-Retina iPhone, iPod Touch, and Android 2.1+ devices: -->
  <link rel="apple-touch-icon" sizes="57x57" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-60x60.png">
  <!-- For first- and second-generation iPad: -->
  <link rel="apple-touch-icon" sizes="72x72" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-76x76.png">
  <!-- For iPhone with high-resolution Retina display running iOS ≤ 6: -->
  <link rel="apple-touch-icon" sizes="114x114" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-114x114.png">
  <!-- For iPhone with high-resolution Retina display running iOS ≥ 7: -->
  <link rel="apple-touch-icon" sizes="120x120" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-120x120.png">
  <!-- For iPad with high-resolution Retina display running iOS ≤ 6: -->
  <link rel="apple-touch-icon" sizes="144x144" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-144x144.png">
  <!-- For iPad with high-resolution Retina display running iOS ≥ 7: -->
  <link rel="apple-touch-icon" sizes="152x152" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="https://karloespiritu.github.io/cheatsheets/public/apple-touch-icon-180x180.png">
  <link rel="icon" type="image/png" href="https://karloespiritu.github.io/cheatsheets/public/favicon-32x32.png" sizes="32x32">
  <link rel="icon" type="image/png" href="https://karloespiritu.github.io/cheatsheets/public/favicon-194x194.png" sizes="194x194">
  <link rel="icon" type="image/png" href="https://karloespiritu.github.io/cheatsheets/public/favicon-96x96.png" sizes="96x96">
  <link rel="icon" type="image/png" href="https://karloespiritu.github.io/cheatsheets/public/android-chrome-192x192.png" sizes="192x192">
  <link rel="icon" type="image/png" href="https://karloespiritu.github.io/cheatsheets/public/favicon-16x16.png?v=1234" sizes="16x16">
  <link rel="manifest" href="https://karloespiritu.github.io/cheatsheets/public/manifest.json">
  <link rel="shortcut icon" href="https://karloespiritu.github.io/cheatsheets/public/favicon.ico">
  <meta name="msapplication-TileColor" content="#000000">
  <meta name="msapplication-TileImage" content="/cheatsheets/public/mstile-144x144.png">
  <meta name="theme-color" content="#000000">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="https://karloespiritu.github.io/atom.xml">
<script type="text/javascript" src="chrome-extension://aadgmnobpdmgmigaicncghmmoeflnamj/ng-inspector.js"></script><meta name="angularinspector" id="angularinspector_meta" content="{&quot;apps&quot;:{&quot;GoogleFontApi&quot;:-1,&quot;http2&quot;:-1},&quot;host&quot;:&quot;karloespiritu.github.io&quot;}"><script type="text/javascript" src="chrome-extension://odkdoekijebogaiopbjgkgogkgifjfnk/detector.js"></script></head>


  <body data-gr-c-s-loaded="true">

    <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">

     <a class="blog-logo" href="http://karloespiritu.com/"><img src="./Postgresql · Cheatsheets_files/logo.svg" alt="Blog Logo"></a>
      <h1>
        <a href="https://karloespiritu.github.io/cheatsheets/">
          Cheatsheets
        </a>
      </h1>
      <p class="lead">"The only difference between science and screwing around is writing it down"</p>
    </div>

    <nav class="sidebar-nav">
<!--       <a class="sidebar-nav-item" href="/cheatsheets/">Home</a> -->

      

      
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/angular/">Angular</a>
          
        
      
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/babel/">Babel</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/bash/">Bash Scripting</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/browserify/">Browserify</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/coffeescript/">Coffeescript</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/css/">CSS</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/curl/">Curl</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/d3/">D3</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/docker/">Docker</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/es6/">ES6</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/favicon/">Favicon</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/flexbox/">Flexbox</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/ghost/">Ghost</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/git/">Git</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/go/">Go</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/gulp/">Gulp</a>
          
        
      
        
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/javascript/">JavaScript</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/linux/">Linux/Unix</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/macosx/">Mac OS X</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/markdown/">Markdown</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/mongodb/">MongoDB</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/mysql/">MySql</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/nginx/">Nginx</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/node/">Node.js</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/npm/">NPM</a>
          
        
      
        
          
            <a class="sidebar-nav-item active" href="https://karloespiritu.github.io/cheatsheets/postgresql/">Postgresql</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/python/">Python</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/qunit/">QUnit</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/rails/">Ruby on Rails</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/railsgems/">Rails Gems</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/rbenv/">rbenv</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/react/">React</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/redux/">Redux</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/regex/">Regular Expressions</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/restfulapis/">RESTful APIs</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/ruby/">Ruby</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/sass/">SASS</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/swift/">Swift</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/webpack/">Webpack</a>
          
        
      
        
          
            <a class="sidebar-nav-item" href="https://karloespiritu.github.io/cheatsheets/yarn/">Yarn</a>
          
        
      
        
      
        
      

<!--       <a class="sidebar-nav-item" href="https://github.com/karloespiritu/cheatsheets/archive/v2.0.1.zip">Download</a> -->
      <hr>
      <a class="sidebar-nav-item" href="https://github.com/karloespiritu/cheatsheets">GitHub project</a>
      <span class="sidebar-nav-item">Currently v2.0.1</span>
    </nav>

    <p>© 2018. All rights reserved.</p>
  </div>
</div>


    <div class="content container">
      <div class="page">
  <h1 class="page-title">Postgresql</h1>
  <h2 id="basic-commands">Basic Commands</h2>

<h3 id="login-to-postgresql">Login to postgresql</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql <span class="nt">-U</span> postgres
psql <span class="nt">-d</span> mydb <span class="nt">-U</span> myuser <span class="nt">-W</span>
psql <span class="nt">-h</span> myhost <span class="nt">-d</span> mydb <span class="nt">-U</span> myuser <span class="nt">-W</span>
psql <span class="nt">-U</span> myuser <span class="nt">-h</span> myhost <span class="s2">"dbname=mydb sslmode=require"</span> <span class="c"># ssl connection</span>
</code></pre></div></div>

<h3 id="default-admin-login">Default Admin Login</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo</span> <span class="nt">-u</span> postgres psql <span class="nt">-U</span> postgres
<span class="nb">sudo</span> <span class="nt">-u</span> postgres psql
</code></pre></div></div>

<h3 id="list-databases-on-postgresql-server">List databases on postgresql server</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql -l [-U myuser] [-W]
</code></pre></div></div>

<h3 id="turn-off-line-pager-pagination-in-psql">Turn off line pager pagination in psql:</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\pset pager
</code></pre></div></div>

<h3 id="determine-system-tables">Determine system tables</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>select * from pg_tables where tableowner = 'postgres';
</code></pre></div></div>

<h3 id="list-databases-from-within-a-pg-shell">List databases from within a pg shell</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\l
</code></pre></div></div>

<h3 id="list-databases-from-unix-command-prompt">List databases from UNIX command prompt</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql -U postgres -l
</code></pre></div></div>

<h3 id="describe-a-table">Describe a table</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\d tablename
</code></pre></div></div>
<h3 id="quit-psql">Quit psql</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\q
</code></pre></div></div>

<h3 id="switch-postgres-database-within-admin-login-shell">Switch postgres database within admin login shell</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\connect databasename
</code></pre></div></div>

<h3 id="reset-a-user-password-as-admin">Reset a user password as admin</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alter user usertochange with password 'new_passwd';
</code></pre></div></div>

<h3 id="show-all-tables">Show all tables</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\dt
</code></pre></div></div>

<h3 id="list-all-schemas">List all Schemas</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\dn
</code></pre></div></div>

<h3 id="list-all-users">List all users</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>\du
</code></pre></div></div>

<h3 id="load-data-into-postgresql">Load data into postgresql</h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>psql <span class="nt">-W</span> <span class="nt">-U</span> username <span class="nt">-H</span> hostname &lt; file.sql
</code></pre></div></div>

<h3 id="dump-backup-data-into-file">Dump (Backup) Data into file</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_dump <span class="nt">-W</span> <span class="nt">-U</span> username <span class="nt">-h</span> hostname database_name <span class="o">&gt;</span> file.sql
</code></pre></div></div>

<h3 id="increment-a-sequence">Increment a sequence</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">nextval</span><span class="p">(</span><span class="s1">'my_id_seq'</span><span class="p">);</span>
</code></pre></div></div>

<h3 id="create-new-user">Create new user</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">USER</span> <span class="n">lemmy</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="s1">'myPassword'</span><span class="p">;</span>
<span class="o">#</span> <span class="k">or</span>

<span class="n">sudo</span> <span class="o">-</span><span class="n">u</span> <span class="n">postgres</span> <span class="k">createuser</span> <span class="n">lemmy</span> <span class="o">-</span><span class="n">W</span>
</code></pre></div></div>

<h3 id="change-user-password">Change user password</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">USER</span> <span class="n">Postgres</span> <span class="k">WITH</span> <span class="n">PASSWORD</span> <span class="s1">'mypass'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="grant-user-createdb-privilege">Grant user createdb privilege</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">ALTER</span> <span class="k">USER</span> <span class="n">myuser</span> <span class="k">WITH</span> <span class="k">createdb</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="create-a-superuser-user">Create a superuser user</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>create user mysuper with password <span class="s1">'1234'</span> SUPERUSER
<span class="c"># or even better</span>
create user mysuper with password <span class="s1">'1234'</span> SUPERUSER CREATEDB CREATEROLE INHERIT LOGIN REPLICATION<span class="p">;</span>
<span class="c"># or</span>
<span class="nb">sudo</span> <span class="nt">-u</span> postgres createuser lemmy <span class="nt">-W</span> <span class="nt">-s</span>
</code></pre></div></div>

<h3 id="upgrade-an-existing-user-to-superuser">Upgrade an existing user to superuser</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>alter user mysuper with superuser;
# or even better
alter user mysuper with SUPERUSER CREATEDB CREATEROLE INHERIT LOGIN REPLICATION
</code></pre></div></div>

<h3 id="show-database-version">Show Database Version</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>SELECT version();
</code></pre></div></div>

<h3 id="change-database-owner">Change Database Owner</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">alter</span> <span class="k">database</span> <span class="n">database_name</span> <span class="k">owner</span> <span class="k">to</span> <span class="n">new_owner</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="copy-a-database">Copy a database</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">newdb</span> <span class="k">WITH</span> <span class="k">TEMPLATE</span> <span class="n">originaldb</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="view-database-connections">View Database Connections</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pg_stat_activity</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="view-show-data-directory-works-on-91">View show data directory (works on 9.1+)</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">show</span> <span class="n">data_directory</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="show-run-time-parameters">Show run-time parameters</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">show</span> <span class="k">all</span><span class="p">;</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">pg_settings</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="show-the-block-size-setting">Show the block size setting</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># show block_size;</span>
 block_size
<span class="nt">------------</span>
 8192
<span class="o">(</span>1 row<span class="o">)</span>
</code></pre></div></div>

<h3 id="show-stored-procedure-source">Show stored procedure source</h3>
<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="n">prosrc</span> <span class="k">FROM</span> <span class="n">pg_proc</span> <span class="k">WHERE</span> <span class="n">proname</span> <span class="o">=</span> <span class="s1">'procname'</span>
</code></pre></div></div>

<h3 id="grant-examples">Grant examples</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code># readonly to all tables for myuser
grant select on all tables in schema public to myuser;
# all privileges on table1 and table2 to myuser
grant all privileges on table1, table2, table3 to myuser;
</code></pre></div></div>

<h3 id="restore-postgres-dump-file">Restore Postgres .dump file</h3>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pg_restore --verbose --clean --no-acl --no-owner -h localhost -U myuser -d mydb latest.dump
</code></pre></div></div>
<p><a href="https://gist.github.com/kagemusha/1569836">source</a></p>

<h3 id="find-all-active-sessions-and-kill-them-ie-for-when-needing-to-drop-or-rename-db">Find all active sessions and kill them (i.e. for when needing to drop or rename db)</h3>
<p>Source: <a href="http://stackoverflow.com/questions/5408156/how-to-drop-a-postgresql-database-if-there-are-active-connections-to-it">http://stackoverflow.com/questions/5408156/how-to-drop-a-postgresql-database-if-there-are-active-connections-to-it</a></p>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">#</span> <span class="n">Postgres</span> <span class="mi">9</span><span class="p">.</span><span class="mi">6</span> <span class="k">and</span> <span class="n">above</span>
<span class="k">SELECT</span> <span class="n">pg_terminate_backend</span><span class="p">(</span><span class="n">pg_stat_activity</span><span class="p">.</span><span class="n">pid</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">pg_stat_activity</span>
<span class="k">WHERE</span> <span class="n">pg_stat_activity</span><span class="p">.</span><span class="n">datname</span> <span class="o">=</span> <span class="s1">'TARGET_DB'</span>
 <span class="k">AND</span> <span class="n">pid</span> <span class="o">&lt;&gt;</span> <span class="n">pg_backend_pid</span><span class="p">();</span>

<span class="o">#</span> <span class="n">Postgres</span> <span class="mi">9</span><span class="p">.</span><span class="mi">6</span> <span class="k">and</span> <span class="n">below</span>
<span class="k">SELECT</span> <span class="n">pg_terminate_backend</span><span class="p">(</span><span class="n">pg_stat_activity</span><span class="p">.</span><span class="n">procpid</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">pg_stat_activity</span>
<span class="k">WHERE</span> <span class="n">pg_stat_activity</span><span class="p">.</span><span class="n">datname</span> <span class="o">=</span> <span class="s1">'TARGET_DB'</span>
<span class="k">AND</span> <span class="n">procpid</span> <span class="o">&lt;&gt;</span> <span class="n">pg_backend_pid</span><span class="p">();</span>
</code></pre></div></div>

<h2 id="handy-queries">Handy Queries</h2>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- List procedure/function</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pg_proc</span> <span class="k">WHERE</span> <span class="n">proname</span><span class="o">=</span><span class="s1">'__procedurename__'</span><span class="p">;</span>

<span class="c1">-- List view (including the definition)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pg_views</span> <span class="k">WHERE</span> <span class="n">viewname</span><span class="o">=</span><span class="s1">'__viewname__'</span><span class="p">;</span>

<span class="c1">-- Show DB table space in use</span>
<span class="k">SELECT</span> <span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_total_relation_size</span><span class="p">(</span><span class="s1">'__table_name__'</span><span class="p">));:</span>

<span class="c1">-- Show DB space in use</span>
<span class="k">SELECT</span> <span class="n">pg_size_pretty</span><span class="p">(</span><span class="n">pg_database_size</span><span class="p">(</span><span class="s1">'__database_name__'</span><span class="p">));</span>

<span class="c1">-- Show current user's statement timeout</span>
<span class="k">show</span> <span class="n">statement_timeout</span><span class="p">;</span>

<span class="c1">-- Show table indexes</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pg_indexes</span> <span class="k">WHERE</span> <span class="n">tablename</span><span class="o">=</span><span class="s1">'__table_name__'</span> <span class="k">AND</span> <span class="n">schemaname</span><span class="o">=</span><span class="s1">'__schema_name__'</span><span class="p">;</span>

<span class="c1">-- Get all indexes from all tables of a schema:</span>
<span class="k">SELECT</span>
   <span class="n">t</span><span class="p">.</span><span class="n">relname</span> <span class="k">AS</span> <span class="k">table_name</span><span class="p">,</span>
   <span class="n">i</span><span class="p">.</span><span class="n">relname</span> <span class="k">AS</span> <span class="n">index_name</span><span class="p">,</span>
   <span class="n">a</span><span class="p">.</span><span class="n">attname</span> <span class="k">AS</span> <span class="k">column_name</span>
<span class="k">FROM</span>
   <span class="n">pg_class</span> <span class="n">t</span><span class="p">,</span>
   <span class="n">pg_class</span> <span class="n">i</span><span class="p">,</span>
   <span class="n">pg_index</span> <span class="n">ix</span><span class="p">,</span>
   <span class="n">pg_attribute</span> <span class="n">a</span><span class="p">,</span>
   <span class="n">pg_namespace</span> <span class="n">n</span>
<span class="k">WHERE</span>
   <span class="n">t</span><span class="p">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">ix</span><span class="p">.</span><span class="n">indrelid</span>
   <span class="k">AND</span> <span class="n">i</span><span class="p">.</span><span class="n">oid</span> <span class="o">=</span> <span class="n">ix</span><span class="p">.</span><span class="n">indexrelid</span>
   <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">attrelid</span> <span class="o">=</span> <span class="n">t</span><span class="p">.</span><span class="n">oid</span>
   <span class="k">AND</span> <span class="n">a</span><span class="p">.</span><span class="n">attnum</span> <span class="o">=</span> <span class="k">ANY</span><span class="p">(</span><span class="n">ix</span><span class="p">.</span><span class="n">indkey</span><span class="p">)</span>
   <span class="k">AND</span> <span class="n">t</span><span class="p">.</span><span class="n">relnamespace</span> <span class="o">=</span> <span class="n">n</span><span class="p">.</span><span class="n">oid</span>
   <span class="k">AND</span> <span class="n">n</span><span class="p">.</span><span class="n">nspname</span> <span class="o">=</span> <span class="s1">'kartones'</span>
<span class="k">ORDER</span> <span class="k">BY</span>
   <span class="n">t</span><span class="p">.</span><span class="n">relname</span><span class="p">,</span>
   <span class="n">i</span><span class="p">.</span><span class="n">relname</span>

<span class="c1">-- Queries being executed at a certain DB</span>
<span class="k">SELECT</span> <span class="n">datname</span><span class="p">,</span> <span class="n">application_name</span><span class="p">,</span> <span class="n">pid</span><span class="p">,</span> <span class="n">backend_start</span><span class="p">,</span> <span class="n">query_start</span><span class="p">,</span> <span class="n">state_change</span><span class="p">,</span> <span class="k">state</span><span class="p">,</span> <span class="n">query</span>
  <span class="k">FROM</span> <span class="n">pg_stat_activity</span>
  <span class="k">WHERE</span> <span class="n">datname</span><span class="o">=</span><span class="s1">'__database_name__'</span><span class="p">;</span>

<span class="c1">-- Get all queries from all dbs waiting for data (might be hung)</span>
<span class="k">SELECT</span> <span class="o">*</span> <span class="k">FROM</span> <span class="n">pg_stat_activity</span> <span class="k">WHERE</span> <span class="n">waiting</span><span class="o">=</span><span class="s1">'t'</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="query-analysis">Query analysis</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>-- See the query plan for the given query
EXPLAIN __query__

-- See and execute the query plan for the given query
EXPLAIN ANALYZE __query__

-- Collect statistics
ANALYZE [__table__]
</code></pre></div></div>

<h2 id="querying-data">Querying Data</h2>

<h3 id="from-a-single-table">From a Single Table</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Query data in columns c1, c2 from a table</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t</span><span class="p">;</span>

<span class="c1">-- Query distinct rows from a table</span>
<span class="k">SELECT</span> <span class="k">DISTINCT</span> <span class="n">c1</span>
<span class="k">FROM</span> <span class="n">t</span>
<span class="k">WHERE</span> <span class="n">condition</span><span class="p">;</span>

<span class="c1">-- Sort the result set in ascending or descending order</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">c1</span> <span class="k">ASC</span> <span class="p">[</span><span class="k">DESC</span><span class="p">];</span>

<span class="c1">-- Skip offset of rows and return the next n rows</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">c1</span>
<span class="k">LIMIT</span> <span class="n">n</span>
<span class="k">OFFSET</span> <span class="k">offset</span><span class="p">;</span>

<span class="c1">-- Group rows using an aggregate function</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="k">aggregate</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
<span class="k">FROM</span> <span class="n">t</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">c1</span><span class="p">;</span>

<span class="c1">-- Filter groups using HAVING clause</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="k">aggregate</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span> <span class="k">FROM</span> <span class="n">t</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">c1</span>
<span class="k">HAVING</span> <span class="n">condition</span><span class="p">;</span>
</code></pre></div></div>

<h3 id="from-multiple-tables">From Multiple Tables</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Inner join t1 and t2</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t1</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">t2</span>
<span class="k">ON</span> <span class="n">condition</span><span class="p">;</span>

<span class="c1">-- Left join t1 and t1</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t1</span>
<span class="k">LEFT</span> <span class="k">JOIN</span> <span class="n">t2</span>
<span class="k">ON</span> <span class="n">condition</span><span class="p">;</span>

<span class="c1">-- Right join t1 and t2</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t1</span>
<span class="k">RIGHT</span> <span class="k">JOIN</span> <span class="n">t2</span>
<span class="k">ON</span> <span class="n">condition</span><span class="p">;</span>

<span class="c1">-- Perform full outer join</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t1</span>
<span class="k">FULL</span> <span class="k">OUTER</span> <span class="k">JOIN</span> <span class="n">t2</span>
<span class="k">ON</span> <span class="n">condition</span><span class="p">;</span>

<span class="c1">-- Produce a Cartesian product of rows in tables</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t1</span>
<span class="k">CROSS</span> <span class="k">JOIN</span> <span class="n">t2</span><span class="p">;</span>

<span class="c1">-- Another way to perform cross join</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">;</span>

<span class="c1">-- Join t1 to itself using INNER JOIN clause</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t1</span> <span class="n">A</span>
<span class="k">INNER</span> <span class="k">JOIN</span> <span class="n">t2</span> <span class="n">B</span> <span class="k">ON</span> <span class="n">condition</span>
</code></pre></div></div>

<h3 id="using-sql-operators">Using SQL Operators</h3>

<div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">-- Combine rows from two queries</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t1</span>
<span class="k">UNION</span> <span class="p">[</span><span class="k">ALL</span><span class="p">]</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t2</span><span class="p">;</span>

<span class="c1">-- Return the intersection of two queries</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t1</span>
<span class="k">INTERSECT</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t2</span><span class="p">;</span>

<span class="c1">-- Subtract a result set from another result set</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t1</span>
<span class="k">EXCEPT</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t2</span><span class="p">;</span>

<span class="c1">-- Query rows using pattern matching %, _</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t1</span>
<span class="k">WHERE</span> <span class="n">c1</span> <span class="p">[</span><span class="k">NOT</span><span class="p">]</span> <span class="k">LIKE</span> <span class="n">pattern</span><span class="p">;</span>

<span class="c1">-- Query rows in a list</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t</span>
<span class="k">WHERE</span> <span class="n">c1</span>
<span class="p">[</span><span class="k">NOT</span><span class="p">]</span> <span class="k">IN</span> <span class="n">value_list</span><span class="p">;</span>

<span class="c1">-- Query rows between two values</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span>
<span class="k">FROM</span> <span class="n">t</span>
<span class="k">WHERE</span> <span class="n">c1</span>
<span class="k">BETWEEN</span> <span class="n">low</span> <span class="k">AND</span> <span class="n">high</span><span class="p">;</span>

<span class="c1">-- Check if values in a table is NULL or not</span>
<span class="k">SELECT</span> <span class="n">c1</span><span class="p">,</span> <span class="n">c2</span> <span class="k">FROM</span> <span class="n">t</span>
<span class="k">WHERE</span> <span class="n">c1</span> <span class="k">IS</span> <span class="p">[</span><span class="k">NOT</span><span class="p">]</span> <span class="k">NULL</span><span class="p">;</span>
</code></pre></div></div>

<h2 id="source">Source:</h2>
<ul>
  <li><a href="https://www.postgresql.org/docs/9.6/static/app-psql.html">PostgreSQL 9.6.0 Documentation</a></li>
  <li><a href="https://pgexercises.com/">PostgreSQL Exercises</a></li>
  <li><a href="http://www.postgresqltutorial.com/postgresql-cheat-sheets">PostgreSQL Tutorial</a></li>
</ul>

</div>

    </div>

  

</body></html>